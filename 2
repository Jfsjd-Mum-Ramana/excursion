@Repository
public interface UCSPAlarmMetricsRepository extends JpaRepository<UCSPAlarmMetrics, Long> {

    @Query(nativeQuery = true, value = """
        SELECT collection_name AS collectionName, last_updated AS lastUpdated,
               CASE :dataType WHEN 'number_of_msgs' THEN number_of_msgs
               ELSE size_of_msgs END AS value
        FROM ucsp_alarm_metrics
        WHERE collection_name IN (
            SELECT collection_name FROM ucsp_alarm_inventory WHERE ucg_source = :protocol
        )
    """)
    List<Map<String, Object>> getScatterPlotData(@Param("protocol") String protocol, @Param("dataType") String dataType);

    @Query(nativeQuery = true, value = """
        SELECT DISTINCT ucg_source FROM ucsp_alarm_inventory
    """)
    List<String> getAvailableProtocols();

    @Query(nativeQuery = true, value = """
        SELECT collection_name AS collectionName, last_updated AS lastUpdated, 
               number_of_msgs AS numberOfMsgs, size_of_msgs AS sizeOfMsgs
        FROM ucsp_alarm_metrics
        WHERE collection_name IN (
            SELECT collection_name FROM ucsp_alarm_inventory WHERE ucg_source = :protocol
        )
    """)
    List<Map<String, Object>> filterDataByProtocol(@Param("protocol") String protocol);
}