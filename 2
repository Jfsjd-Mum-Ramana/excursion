Here is the updated repository code for handling the two GraphQL APIs:

Changes to UCSPAlarmRepository

1. The repository now includes queries for fetching scatter plot data based on protocol and date range, and for fetching scatter plot data filtered only by protocol.


2. Added a method to retrieve all available protocols.



package com.verizon.ucs.restapi.repository;

import com.verizon.ucs.restapi.model.ScatterPlotData;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

import java.time.LocalDateTime;
import java.util.List;

@Repository
public interface UCSPAlarmRepository extends JpaRepository<ScatterPlotData, Long> {

    // Fetch scatter plot data based on protocol and date range
    @Query("SELECT new com.verizon.ucs.restapi.model.ScatterPlotData(s.collectionName, s.collectionDate, m.sizeOfMsgs) " +
            "FROM UCSPAlarmMetrics m " +
            "JOIN UCSPAlarmInventory i ON m.ucspAlarmInventory.collectionName = i.collectionName " +
            "WHERE i.ucgSource = :protocol " +
            "AND m.lastUpdated BETWEEN :startDate AND :endDate")
    List<ScatterPlotData> findByProtocolAndDateRange(String protocol, LocalDateTime startDate, LocalDateTime endDate);

    // Fetch scatter plot data filtered by protocol
    @Query("SELECT new com.verizon.ucs.restapi.model.ScatterPlotData(s.collectionName, s.collectionDate, m.sizeOfMsgs) " +
            "FROM UCSPAlarmMetrics m " +
            "JOIN UCSPAlarmInventory i ON m.ucspAlarmInventory.collectionName = i.collectionName " +
            "WHERE i.ucgSource = :protocol")
    List<ScatterPlotData> findByProtocol(String protocol);

    // Fetch all available protocols
    @Query("SELECT DISTINCT i.ucgSource FROM UCSPAlarmInventory i")
    List<String> findAllProtocols();
}

Key Adjustments

Changed the queries to reflect the relationship between UCSPAlarmInventory, UCSPAlarmMetrics, and ScatterPlotData.

Queries use JPQL to fetch specific fields for optimized performance.

Query parameterized inputs (:protocol, :startDate, :endDate) for safer and dynamic queries.


Explanation of API Mapping

findByProtocolAndDateRange: Fetches scatter plot data filtered by protocol and a date range (startDate and endDate).

findByProtocol: Fetches scatter plot data filtered only by protocol.

findAllProtocols: Fetches a list of all unique protocols in the inventory.


Would you like updates to the Controller or Service layers based on this repository?

