public class S3Controller {

    private final AmazonS3 s3Client;

    @Autowired
    public S3Controller(AmazonS3 s3Client) {
        this.s3Client = s3Client;
    }

    @GetMapping(value = "/s3download", produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)
    public void downloadFile(@RequestParam String bucketName,
                             @RequestParam String key,
                             HttpServletResponse response) throws IOException {
//        key = "local/CSV_ORACLESTP/localhost/05252024/bulkstat20240202185100/bulkstat20240202185100.txt";

        String fileName = key.substring(key.lastIndexOf("/") + 1);

        S3Object s3Object = s3Client.getObject(bucketName, key);
        try (S3ObjectInputStream inputStream = s3Object.getObjectContent()) {
            response.setHeader("Content-Disposition", "attachment; filename=" + fileName);
            response.setHeader("Content-Length", String.valueOf(s3Object.getObjectMetadata().getContentLength()));

            try (OutputStream outputStream = response.getOutputStream()) {
                int len;
                byte[] buffer = new byte[4096];
                while ((len = inputStream.read(buffer, 0, buffer.length)) != -1) {
                    outputStream.write(buffer, 0, len);
                }
                outputStream.flush();
            }
        }
    }
}
