Feature: Download file from S3 bucket

  Scenario: Download a file successfully
    Given a valid S3 bucket "bucket-name"
    When I download the file "key/file.txt"
    Then the file should be downloaded successfully

  Scenario: Handle IOException during download
    Given a valid S3 bucket "bucket-name"
    When an IOException occurs during download
    Then the download should fail gracefully

  Scenario: Handle partial read during download
    Given a valid S3 bucket "bucket-name"
    When a partial read occurs during download
    Then the download should handle it properly



package org.vdsi.space.collections.customauditengine.junits.stepdefinitions;

import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.vdsi.space.collections.customauditengine.controllers.S3Controller;
import org.vdsi.space.collections.customauditengine.junits.controllers.S3ControllerTest;

public class S3ControllerSteps {

    private S3Controller s3Controller;
    private String bucketName;
    private String key;
    private String errorMessage;
    private boolean success;

    @Given("a valid S3 bucket {string}")
    public void aValidS3Bucket(String bucketName) {
        this.bucketName = bucketName;
        this.s3Controller = new S3Controller();
    }

    @When("I download the file {string}")
    public void iDownloadTheFile(String key) {
        this.key = key;
        success = s3Controller.downloadFile(bucketName, key);
    }

    @Then("the file should be downloaded successfully")
    public void theFileShouldBeDownloadedSuccessfully() {
        assert success;
    }

    @When("an IOException occurs during download")
    public void anIOExceptionOccursDuringDownload() {
        errorMessage = S3ControllerTest.simulateIOException(s3Controller, bucketName, key);
    }

    @Then("the download should fail gracefully")
    public void theDownloadShouldFailGracefully() {
        assert errorMessage != null && !errorMessage.isEmpty();
    }

    @When("a partial read occurs during download")
    public void aPartialReadOccursDuringDownload() {
        success = S3ControllerTest.simulatePartialRead(s3Controller, bucketName, key);
    }

    @Then("the download should handle it properly")
    public void theDownloadShouldHandleItProperly() {
        assert success;
    }
}
