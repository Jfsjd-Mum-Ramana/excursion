@Test
    public void testRetrieveData_FileRetrievalFailureForSpecificFile() throws Exception {
        // Mock the channelSftp.get method
        InputStream mockInputStream = mock(InputStream.class);
        when(channelSftp.get(anyString())).thenReturn(mockInputStream);
        when(channelSftp.get("/path/to/input/Sample2.csv")).thenThrow(new SftpException(0, "file retrieval failed"));

        // Mock the outputStreamCreator.create method
        OutputStream mockOutputStream = mock(OutputStream.class);
        when(outputStreamCreator.create(anyString())).thenReturn(mockOutputStream);

        // Mock the behavior of the InputStream and OutputStream
        when(mockInputStream.read(ArgumentMatchers.any(byte[].class))).thenReturn(-1); // Simulate end of stream
        doNothing().when(mockOutputStream).close();
        doNothing().when(mockInputStream).close();

        // Mock the ls() method to return three files
        Vector<ChannelSftp.LsEntry> files = new Vector<>();
        for (String fileName : new String[]{"Sample1.csv", "Sample2.csv", "Sample3.csv"}) {
            ChannelSftp.LsEntry file = mock(ChannelSftp.LsEntry.class);
            SftpATTRS attrs = mock(SftpATTRS.class);
            when(file.getFilename()).thenReturn(fileName);
            when(file.getAttrs()).thenReturn(attrs);
            when(attrs.isDir()).thenReturn(false);
            files.add(file);
        }
        when(channelSftp.ls(anyString())).thenReturn(files);

        // Mock the findLatestByFilePaths() method to return two records
        List<CollectionAudit> audits = new ArrayList<>();
        for (String fileName : new String[]{"/path/to/input/Sample1.csv", "/path/to/input/Sample3.csv"}) {
            CollectionAudit audit = mock(CollectionAudit.class);
            when(audit.getInputFilePath()).thenReturn(fileName);
            when(audit.getJobStatus()).thenReturn(fileName.equals("/path/to/input/Sample1.csv") ? "COLLECTION_FAILED" : "COLLECTION_SUCCESS");
            audits.add(audit);
        }
//        when(collectionAuditRepository.findLatestByFilePaths(anyList())).thenReturn(audits);
        doReturn(audits).when(collectionAuditRepository).findLatestByFilePaths(anyList());

        SpaceCollector spaceCollector = new SpaceCollector();
        // Set the fields of the spaceCollector object here
        spaceCollector.setUrl("localhost");
        spaceCollector.setPort(22);
        spaceCollector.setUserName("username");
        spaceCollector.setPassword("password");
        spaceCollector.setInputFilePath("/path/to/input");
        spaceCollector.setOutputFilePath("/path/to/output");

        boolean result = sshService.retrieveData(spaceCollector, collectorUtil.getDateAsString(new Date()), "3459-DEV-COLLECTION-AUDIT-QUEUE");

        // Verify that get() method is called twice
        verify(channelSftp, times(2)).get(anyString());



@Test
    public void testRetrieveData_FileRetrievalFailureForSpecificFile() throws Exception {
        // Mock the channelSftp.get method
        InputStream mockInputStream = mock(InputStream.class);
        when(channelSftp.get(anyString())).thenReturn(mockInputStream);
        when(channelSftp.get("/path/to/input/Sample2.csv")).thenThrow(new SftpException(0, "file retrieval failed"));

        // Mock the outputStreamCreator.create method
        OutputStream mockOutputStream = mock(OutputStream.class);
        when(outputStreamCreator.create(anyString())).thenReturn(mockOutputStream);

        // Mock the behavior of the InputStream and OutputStream
        when(mockInputStream.read(ArgumentMatchers.any(byte[].class))).thenReturn(-1); // Simulate end of stream
        doNothing().when(mockOutputStream).close();
        doNothing().when(mockInputStream).close();

        // Mock the ls() method to return three files
        Vector<ChannelSftp.LsEntry> files = new Vector<>();
        for (String fileName : new String[]{"Sample1.csv", "Sample2.csv", "Sample3.csv"}) {
            ChannelSftp.LsEntry file = mock(ChannelSftp.LsEntry.class);
            SftpATTRS attrs = mock(SftpATTRS.class);
            when(file.getFilename()).thenReturn(fileName);
            when(file.getAttrs()).thenReturn(attrs);
            when(attrs.isDir()).thenReturn(false);
            files.add(file);
        }
        when(channelSftp.ls(anyString())).thenReturn(files);

        // Mock the findLatestByFilePaths() method to return two records
        List<CollectionAudit> audits = new ArrayList<>();
        for (String fileName : new String[]{"/path/to/input/Sample1.csv", "/path/to/input/Sample3.csv"}) {
            CollectionAudit audit = mock(CollectionAudit.class);
            when(audit.getInputFilePath()).thenReturn(fileName);
            when(audit.getJobStatus()).thenReturn(fileName.equals("/path/to/input/Sample1.csv") ? "COLLECTION_FAILED" : "COLLECTION_SUCCESS");
            audits.add(audit);
        }
//        when(collectionAuditRepository.findLatestByFilePaths(anyList())).thenReturn(audits);
        doReturn(audits).when(collectionAuditRepository).findLatestByFilePaths(anyList());

        SpaceCollector spaceCollector = new SpaceCollector();
        // Set the fields of the spaceCollector object here
        spaceCollector.setUrl("localhost");
        spaceCollector.setPort(22);
        spaceCollector.setUserName("username");
        spaceCollector.setPassword("password");
        spaceCollector.setInputFilePath("/path/to/input");
        spaceCollector.setOutputFilePath("/path/to/output");

        boolean result = sshService.retrieveData(spaceCollector, collectorUtil.getDateAsString(new Date()), "3459-DEV-COLLECTION-AUDIT-QUEUE");

        // Verify that get() method is called twice
        verify(channelSftp, times(2)).get(anyString());
