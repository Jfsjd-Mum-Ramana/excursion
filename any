import java.io.*;
import java.util.zip.GZIPInputStream;

public class ZipUtil {

    // Existing code...

    public static void untarAndUngzip(String tarGzFilePath, String destDir) throws IOException {
        try (TarArchiveInputStream tarInput = new TarArchiveInputStream(new GzipCompressorInputStream(new FileInputStream(tarGzFilePath)))) {
            TarArchiveEntry entry;
            while ((entry = tarInput.getNextTarEntry()) != null) {
                File destPath = new File(destDir, entry.getName());
                if (entry.isDirectory()) {
                    destPath.mkdirs();
                } else {
                    destPath.getParentFile().mkdirs();
                    // Check if the file is a .gz file
                    if (entry.getName().endsWith(".gz")) {
                        // Unzip the .gz file
                        ungzip(tarInput, destPath);
                    } else {
                        // Untar regular files
                        untarFile(tarInput, destPath);
                    }
                }
            }
        }
    }

    private static void ungzip(InputStream inputStream, File destFile) throws IOException {
        byte[] buffer = new byte[1024];
        try (GZIPInputStream gzipInputStream = new GZIPInputStream(inputStream);
             FileOutputStream fos = new FileOutputStream(destFile)) {
            int len;
            while ((len = gzipInputStream.read(buffer)) != -1) {
                fos.write(buffer, 0, len);
            }
        }
    }

    private static void untarFile(InputStream inputStream, File destFile) throws IOException {
        try (BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(destFile))) {
            byte[] buffer = new byte[1024];
            int len;
            while ((len = inputStream.read(buffer)) != -1) {
                bos.write(buffer, 0, len);
            }
        }
    }
}
