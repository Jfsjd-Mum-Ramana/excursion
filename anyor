Here is the updated schema for the ucsp_alarm_metrics table, incorporating the requested changes:

Updated Table: ucsp_alarm_metrics

CREATE TABLE ucsp_alarm_metrics (
    id SERIAL PRIMARY KEY,
    collection_id INT NOT NULL,
    collection_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    number_of_msgs BIGINT NOT NULL,
    size_of_msgs BIGINT NOT NULL,
    CONSTRAINT fk_collection_id FOREIGN KEY (collection_id) REFERENCES ucsp_alarm_inventory(id) ON DELETE CASCADE
);

Explanation of Changes:

1. Column Changes:

Renamed last_updated to collection_date.

Renamed collection_name to collection_id and made it an INT type to reference the id column in the ucsp_alarm_inventory table.



2. Foreign Key Constraint:

Added a foreign key constraint to reference the id column in the ucsp_alarm_inventory table (ON DELETE CASCADE ensures that metrics are automatically deleted when a collection is removed).




Example Queries:

Here are some queries you can use with the updated schema:

1. Insert Metrics for a Collection

INSERT INTO ucsp_alarm_metrics (collection_id, collection_date, number_of_msgs, size_of_msgs)
VALUES (1, '2024-12-13 10:30:00', 1000, 204800);

2. Fetch Metrics with Collection Details

SELECT 
    i.device_name,
    i.device_ip,
    m.collection_date,
    m.number_of_msgs,
    m.size_of_msgs
FROM 
    ucsp_alarm_metrics m
JOIN 
    ucsp_alarm_inventory i
ON 
    m.collection_id = i.id;

3. Update Metrics for a Collection

UPDATE ucsp_alarm_metrics
SET number_of_msgs = 1200, size_of_msgs = 250000
WHERE collection_id = 1;

4. Delete Collection and Related Metrics

DELETE FROM ucsp_alarm_inventory
WHERE id = 1;

Let me know if you need further refinements or additional queries!

