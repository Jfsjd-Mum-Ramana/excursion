import { Box, Button, Card, CardContent, Container, FormControl, Grid, InputLabel, MenuItem, Select, SelectChangeEvent, TextField, Typography } from '@mui/material';
import { DataGrid, GridColDef } from '@mui/x-data-grid';
import axios from 'axios';
import React, { useEffect, useState } from 'react';
import { authenticate, getToken } from '../auth';

interface Device {
    device_name: string;
    model: string;
    loopback: string;
    status: string;
    vendor: string;
    router_type: string;
    pollercluster: string;
    poll_interval: string;
    network: string;
    last_update: string;
    phys_ip_address: string;
}

const DashboardGridData: React.FC = () => {
    const [selectedDeviceName, setSelectedDeviceName] = useState<string>('');
    const [selectedDeviceIp, setSelectedDeviceIp] = useState<string>('');
    const [selectedDeviceModel, setSelectedDeviceModel] = useState<string>('');
    const [selectedDeviceVendor, setSelectedDeviceVendor] = useState<string>('');
    const [selectedDeviceNetwork, setSelectedDeviceNetwork] = useState<string>('');
    const [data, setData] = useState<Device[]>([]);
    const [loading, setLoading] = useState<boolean>(false);

    const [deviceModels, setDeviceModels] = useState<string[]>([]);
    const [deviceVendors, setDeviceVendors] = useState<string[]>([]);
    const [deviceNetworks, setDeviceNetworks] = useState<string[]>([]);
    const [dropdownLoading, setDropdownLoading] = useState<boolean>(true);

    useEffect(() => {
        const fetchDropDownData = async () => {
            try {
                setDropdownLoading(true);
                await authenticate("Eclipse", __UCS_API_PW__);
                const token = getToken();
                const headers = { Authorization: `Bearer ${token}` }
                const [modelsResponse, vendorsResponse, networksResponse] = await Promise.all([
                    axios.get<string[]>(__UCS_GET_DEVICE_MODELS__, { headers }),
                    axios.get<string[]>(__UCS_GET_DEVICE_VENDORS__, { headers }),
                    axios.get<string[]>(__UCS_GET_DEVICE_NETWORK__, { headers }),
                ]);
                setDeviceModels(modelsResponse.data.length ? modelsResponse.data : ["No options available"]);
                setDeviceVendors(vendorsResponse.data.length ? vendorsResponse.data : ["No options available"]);
                setDeviceNetworks(networksResponse.data.length ? networksResponse.data : ["No options available"]);
            } catch (error) {
                console.error('Error fetching dropdown data', error);
                 setDeviceModels(["localhost:"]);
                 setDeviceVendors(["Failed to load options"]);
                 setDeviceNetworks(["Failed to load options"]);
            } finally {
                setDropdownLoading(false);
            }
        };

        fetchDropDownData();
    }, []);

    const handleSelectChange = (setter: React.Dispatch<React.SetStateAction<string>>, resetOthers: () => void) => (event: SelectChangeEvent<string>) => {
        resetOthers();
        setter(event.target.value as string);
    };

    const handleTextFieldChange = (setter: React.Dispatch<React.SetStateAction<string>>, resetOthers: () => void) => (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
        resetOthers();
        setter(event.target.value);
    };

    const resetSelections = () => {
        setSelectedDeviceName('');
        setSelectedDeviceIp('');
        setSelectedDeviceModel('');
        setSelectedDeviceVendor('');
        setSelectedDeviceNetwork('');
    }

    const handleSubmit = async () => {
        setLoading(true);
        try {
            const token = getToken();
            const headers = { Authorization: `Bearer ${token}` }
            let response;
            if (selectedDeviceName) {
                response = await axios.get<Device[]>("https://localhost:8080/", {
                    params: {
                        searchType: 'device_name',
                        searchValue: selectedDeviceName
                    },
                    headers
                });
            } else if (selectedDeviceIp) {
                response = await axios.get<Device[]>("", {
                    params: {
                        searchType: 'loopback',
                        searchValue: selectedDeviceIp
                    },
                    headers
                });
            } else if (selectedDeviceModel) {
                response = await axios.get<Device[]>("", {
                    params: {
                        searchType: 'model',
                        searchValue: selectedDeviceModel
                    },
                    headers
                });
            } else if (selectedDeviceVendor) {
                response = await axios.get<Device[]>("", {
                    params: {
                        searchType: 'vendor',
                        searchValue: selectedDeviceVendor
                    },
                    headers
                });
            } else if (selectedDeviceNetwork) {
                response = await axios.get<Device[]>("", {
                    params: {
                        searchType: 'network',
                        searchValue: selectedDeviceNetwork
                    },
                    headers
                });
            }
            if (response) {
                setData(response.data);
            }
        } catch (error) {
            console.error('Error fetching data', error);
        } finally {
            setLoading(false);
        }
    };

    const columns: GridColDef[] = [
        { field: 'device_name', headerName: 'Device Name', minWidth: 150, flex: 1 },
        { field: 'model', headerName: 'Model', minWidth: 150, flex: 1 },
        { field: 'loopback', headerName: 'Loopback', minWidth: 150, flex: 1 },
        { field: 'status', headerName: 'Status', minWidth: 150, flex: 1 },
        { field: 'vendor', headerName: 'Vendor', minWidth: 150, flex: 1 },
        { field: 'router_type', headerName: 'Router Type', minWidth: 150, flex: 1 },
        { field: 'pollercluster', headerName: 'Poller Cluster', minWidth: 150, flex: 1 },
        { field: 'poll_interval', headerName: 'Poll Interval', minWidth: 150, flex: 1 },
        { field: 'network', headerName: 'Network', minWidth: 150, flex: 1 },
        { field: 'last_update', headerName: 'Last Update', minWidth: 150, flex: 1 },
        { field: 'phys_ip_address', headerName: 'Physical IP', minWidth: 150, flex: 1 },
    ];

    return (
        <Container maxWidth="lg">
            <Typography gutterBottom variant="h4" className="header" fontWeight={"bold"} paddingTop={"15px"}>
                UCS Portal
            </Typography>
            <Card sx={{ boxShadow: 1, border: 1 }}>
                <CardContent>
                    <Grid container spacing={2}>
                        <Grid item xs={12} sm={6} md={3}>
                            <TextField
                                placeholder="Enter Device Name"
                                fullWidth
                                variant="outlined"
                                value={selectedDeviceName}
                                onChange={(event) => handleTextFieldChange(setSelectedDeviceName, resetSelections)(event)}
                                label="Device Name"
                            />
                        </Grid>
                        <Grid item xs={12} sm={6} md={3}>
                            <TextField
                                placeholder="Enter Device IP"
                                fullWidth
                                variant="outlined"
                                value={selectedDeviceIp}
                                onChange={(event) => handleTextFieldChange(setSelectedDeviceIp, resetSelections)(event)}
                                label="Device IP"
                            />
                        </Grid>
                        <Grid item xs={12} sm={6} md={3}>
                            <FormControl fullWidth variant="outlined">
                                <InputLabel id="device-model-select-label">Device Model</InputLabel>
                                <Select
                                    labelId="device-model-select-label"
                                    value={selectedDeviceModel}
                                    onChange={(event) => handleSelectChange(setSelectedDeviceModel, resetSelections)(event)}
                                    label="Device Model"
                                >
                                    {deviceModels.map((model) => (
                                        <MenuItem key={model} value={model}>
                                            {model}
                                        </MenuItem>
                                    ))}
                                </Select>
                            </FormControl>
                        </Grid>
                        <Grid item xs={12} sm={6} md={3}>
                            <FormControl fullWidth variant="outlined">
                                <InputLabel id="device-vendor-select-label">Device Vendor</InputLabel>
                                <Select
                                    labelId="device-vendor-select-label"
                                    value={selectedDeviceVendor}
                                    onChange={(event) => handleSelectChange(setSelectedDeviceVendor, resetSelections)(event)}
                                    label="Device Vendor"
                                >
                                    {deviceVendors.map((vendor) => (
                                        <MenuItem key={vendor} value={vendor}>
                                            {vendor}
                                        </MenuItem>
                                    ))}
                                </Select>
                            </FormControl>
                        </Grid>
                        <Grid item xs={12} sm={6} md={3}>
                            <FormControl fullWidth variant="outlined">
                                <InputLabel id="device-network-select-label">Device Network</InputLabel>
                                <Select
                                    labelId="device-network-select-label"
                                    value={selectedDeviceNetwork}
                                    onChange={(event) => handleSelectChange(setSelectedDeviceNetwork, resetSelections)(event)}
                                    label="Device Network"
                                >
                                    {deviceNetworks.map((network) => (
                                        <MenuItem key={network} value={network}>
                                            {network}
                                        </MenuItem>
                                    ))}
                                </Select>
                            </FormControl>
                        </Grid>
                    </Grid>
                    <Button
                        variant="contained"
                        color="primary"
                        onClick={handleSubmit}
                        disabled={!selectedDeviceName && !selectedDeviceIp && !selectedDeviceModel && !selectedDeviceVendor && !selectedDeviceNetwork}
                        sx={{ mt: 2 }}
                    >
                        Submit
                    </Button>
                </CardContent>
            </Card>
            <Box mt={4} sx={{ height: 400, width: "100%" }}>
                <DataGrid
                    rows={data}
                    columns={columns}
                    initialState={{
                        pagination: {
                            paginationModel: {
                                pageSize: 10,
                                page: 0
                            }
                        }
                    }}
                    sx={{
                        boxShadow: 1,
                        border: 1,
                    }}
                    pageSizeOptions={[5, 10, 25]}
                    pagination
                    slotProps={{
                        footer: {
                            sx: {
                                justifyContent: "flex-start"
                            }
                        }
                    }}
                    checkboxSelection
                    disableRowSelectionOnClick
                    loading={loading}
                    autoHeight
                />
            </Box>
        </Container>
    );
}

export default DashboardGridData


Here the above is front end code connect this according to here acceptance criteria:

AC 1: API Integration for Dropdown Population

Given the unique details API is available,

When the Device search page is loaded,

Then the API should be called to fetch unique models, vendors, and network details to populate the respective dropdowns.



AC 2: Successful Population of Dropdowns

Given unique details for models, vendors, and network are fetched from the API,

When the data is received,

Then each dropdown (models, vendors, network) on the Device search page should be populated with the unique data, allowing users to select from the available options.



AC 3: Dynamic Update of Dropdowns

Given any updates or changes occur in the database regarding models, vendors, or network details,

When the Device search page is reloaded or refreshed,

Then the dropdowns should dynamically update to reflect the latest unique details fetched from the API.



AC 4: Handling No Data

Given the API call for fetching unique details returns no data for models, vendors, or network,

When attempting to populate the dropdowns,

Then each dropdown should display a message indicating "No options available", ensuring the user is informed about the lack of data.



AC 5: Error Handling

Given an error occurs during the API call for fetching unique details (e.g., network error, API downtime),

When loading the Device search page,

Then the dropdowns should display a default error message, such as "Failed to load options", and the user should be informed about the issue.



AC 6: User Feedback on Loading

Given the API call is made to fetch unique details for populating the dropdowns,

When the data is being fetched,

Then each dropdown should show a loading indicator or message, such as "Loading options...", to inform the user that data retrieval is in progress.



AC 7: Documentation and Examples

Given the integration is completed,

When documenting the integration process,

Then there should be clear documentation on how the unique details API is integrated with the Device search page for populating the dropdowns, including code snippets and examples. This documentation should also cover handling dynamic updates, no data ACs, errors, and loading states for the dropdowns.
