package com.verizon.ucs.service;

import org.springframework.stereotype.Component;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.web.client.HttpClientErrorException;
import org.springframework.web.client.HttpServerErrorException;
import org.springframework.web.client.RestTemplate;

import com.verizon.ucs.model.DataWrapperDTO;
import com.verizon.ucs.properties.DbProperties;
import com.verizon.ucs.util.RestTemplateCustomizer;

@Component
public class TtlScheduler {
    private static final Logger logger = LoggerFactory.getLogger(TtlScheduler.class);

    @Autowired
    private RestTemplateCustomizer restTemplateCustomizer;

    @Autowired
    private DbProperties databaseConfig;

    // @Scheduled(cron = "0 0 0 * * ?") // Every day at midnight
    @Scheduled(cron = "${scheduler.ttl.cron}")
    public void scheduleCallStp() {
        try {

            DataWrapperDTO dto = new DataWrapperDTO();
            dto.setParameterList(new String[] { "dummy" });
            dto.setStpName(databaseConfig.getTransactionDeleteStpName());// delete_hpov_s2im_transactions
            restTemplateCustomizer.callApi(dto);
        } catch (Exception e) {
            logger.error("error while deleting the transactions", e);
        }
    }

}
