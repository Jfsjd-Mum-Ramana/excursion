package com.verizon.ucs.model;

public class RecoveryResponse {
	private String ucgTimestamp;
	private String ucgSource;
	private String ucgRawData;
	private String ucgDeviceName;
	private String ucgType;
	private String ucgTopic;

	// Getters and setters
	public String getUcgTimestamp() {
		return ucgTimestamp;
	}

	public void setUcgTimestamp(String ucgTimestamp) {
		this.ucgTimestamp = ucgTimestamp;
	}

	public String getUcgSource() {
		return ucgSource;
	}

	public void setUcgSource(String ucgSource) {
		this.ucgSource = ucgSource;
	}

	public String getUcgRawData() {
		return ucgRawData;
	}

	public void setUcgRawData(String ucgRawData) {
		this.ucgRawData = ucgRawData;
	}

	public String getUcgDeviceName() {
		return ucgDeviceName;
	}

	public void setUcgDeviceName(String ucgDeviceName) {
		this.ucgDeviceName = ucgDeviceName;
	}

	public String getUcgType() {
		return ucgType;
	}

	public void setUcgType(String ucgType) {
		this.ucgType = ucgType;
	}

	public String getUcgTopic() {
		return ucgTopic;
	}

	public void setUcgTopic(String ucgTopic) {
		this.ucgTopic = ucgTopic;
	}
}

package com.verizon.ucs.model;

public class NexusData1500 {
	
    // private String firmware;
    // private String deviceName;
    private String deviceType;
    private String van;
    private String vbn;
    private String vcn;
    private String vab;
    private String vbc;
    private String vca;
    private String ia;
    private String ib;
    private String ic;
    private String freq;
    private String pf;
    private String watt;
    // private String wattHr;

	// public String getFirmware() {
	// 	return firmware;
	// }
	// public void setFirmware(String firmware) {
	// 	this.firmware = firmware;
	// }
	// public String getDeviceName() {
	// 	return deviceName;
	// }
	// public void setDeviceName(String deviceName) {
	// 	this.deviceName = deviceName;
	// }
	public String getDeviceType() {
		return deviceType;
	}
	public void setDeviceType(String deviceType) {
		this.deviceType = deviceType;
	}
	public String getVan() {
		return van;
	}
	public void setVan(String van) {
		this.van = van;
	}
	public String getVbn() {
		return vbn;
	}
	public void setVbn(String vbn) {
		this.vbn = vbn;
	}
	public String getVcn() {
		return vcn;
	}
	public void setVcn(String vcn) {
		this.vcn = vcn;
	}
	public String getVab() {
		return vab;
	}
	public void setVab(String vab) {
		this.vab = vab;
	}
	public String getVbc() {
		return vbc;
	}
	public void setVbc(String vbc) {
		this.vbc = vbc;
	}
	public String getVca() {
		return vca;
	}
	public void setVca(String vca) {
		this.vca = vca;
	}
	public String getIa() {
		return ia;
	}
	public void setIa(String ia) {
		this.ia = ia;
	}
	public String getIb() {
		return ib;
	}
	public void setIb(String ib) {
		this.ib = ib;
	}
	public String getIc() {
		return ic;
	}
	public void setIc(String ic) {
		this.ic = ic;
	}
	public String getFreq() {
		return freq;
	}
	public void setFreq(String freq) {
		this.freq = freq;
	}
	public String getPf() {
		return pf;
	}
	public void setPf(String pf) {
		this.pf = pf;
	}
	public String getWatt() {
		return watt;
	}
	public void setWatt(String watt) {
		this.watt = watt;
	}
	// public String getWattHr() {
	// 	return wattHr;
	// }
	// public void setWattHr(String wattHr) {
	// 	this.wattHr = wattHr;
	// }

	// @Override
	// public String toString() {
	// 	return "NexusData [firmware=" + firmware + ", deviceName=" + deviceName + ", deviceType=" + deviceType
	// 			+ ", van=" + van + ", vbn=" + vbn + ", vcn=" + vcn + ", vab=" + vab + ", vbc=" + vbc + ", vca=" + vca
	// 			+ ", ia=" + ia + ", ib=" + ib + ", ic=" + ic + ", freq=" + freq + ", pf=" + pf + ", watt=" + watt
	// 			+ ", wattHr=" + wattHr + "]";
	// }
	@Override
	public String toString() {
		return "NexusData [deviceType=" + deviceType
				+ ", van=" + van + ", vbn=" + vbn + ", vcn=" + vcn + ", vab=" + vab + ", vbc=" + vbc + ", vca=" + vca
				+ ", ia=" + ia + ", ib=" + ib + ", ic=" + ic + ", freq=" + freq + ", pf=" + pf + ", watt=" + watt
				+  "]";
	}

    // Getters and Setters
    
}
package com.verizon.ucs.model;

public class NexusData1450 {
	
	private String serial;
    private String firmware;
    private String deviceName;
    private String deviceType;
	private String mac;
    private String van;
    private String vbn;
    private String vcn;
    private String vab;
    private String vbc;
    private String vca;
    private String ia;
    private String ib;
    private String ic;
    private String freq;
    private String pf;
    private String watt;
    private String wattHr;
    
    
	public String getFirmware() {
		return firmware;
	}
	public void setFirmware(String firmware) {
		this.firmware = firmware;
	}
	public String getDeviceName() {
		return deviceName;
	}
	public void setDeviceName(String deviceName) {
		this.deviceName = deviceName;
	}
	public String getDeviceType() {
		return deviceType;
	}
	public void setDeviceType(String deviceType) {
		this.deviceType = deviceType;
	}
	public String getVan() {
		return van;
	}
	public void setVan(String van) {
		this.van = van;
	}
	public String getVbn() {
		return vbn;
	}
	public void setVbn(String vbn) {
		this.vbn = vbn;
	}
	public String getVcn() {
		return vcn;
	}
	public void setVcn(String vcn) {
		this.vcn = vcn;
	}
	public String getVab() {
		return vab;
	}
	public void setVab(String vab) {
		this.vab = vab;
	}
	public String getVbc() {
		return vbc;
	}
	public void setVbc(String vbc) {
		this.vbc = vbc;
	}
	public String getVca() {
		return vca;
	}
	public void setVca(String vca) {
		this.vca = vca;
	}
	public String getIa() {
		return ia;
	}
	public void setIa(String ia) {
		this.ia = ia;
	}
	public String getIb() {
		return ib;
	}
	public void setIb(String ib) {
		this.ib = ib;
	}
	public String getIc() {
		return ic;
	}
	public void setIc(String ic) {
		this.ic = ic;
	}
	public String getFreq() {
		return freq;
	}
	public void setFreq(String freq) {
		this.freq = freq;
	}
	public String getPf() {
		return pf;
	}
	public void setPf(String pf) {
		this.pf = pf;
	}
	public String getWatt() {
		return watt;
	}
	public void setWatt(String watt) {
		this.watt = watt;
	}
	public String getWattHr() {
		return wattHr;
	}
	public void setWattHr(String wattHr) {
		this.wattHr = wattHr;
	}
	public String getSerial() {
		return serial;
	}
	public void setSerial(String serial) {
		this.serial = serial;
	}
	public String getMac() {
		return mac;
	}
	public void setMac(String mac) {
		this.mac = mac;
	}
	@Override
	public String toString() {
		return "NexusData [firmware=" + firmware + ", deviceName=" + deviceName + ", deviceType=" + deviceType
				+ ", van=" + van + ", vbn=" + vbn + ", vcn=" + vcn + ", vab=" + vab + ", vbc=" + vbc + ", vca=" + vca
				+ ", ia=" + ia + ", ib=" + ib + ", ic=" + ic + ", freq=" + freq + ", pf=" + pf + ", watt=" + watt
				+ ", wattHr=" + wattHr + ", serial=" + serial + ", mac=" + mac + "]";
	}

    // Getters and Setters
    
}

package com.verizon.ucs.model;

public class NexusData1250 {
	
    // private String firmware;
    // private String deviceName;
    private String deviceType;
    private String van;
    private String vbn;
    private String vcn;
    private String vab;
    private String vbc;
    private String vca;
    private String ia;
    private String ib;
    private String ic;
    private String freq;
    private String pf;
    private String watt;
    // private String wattHr;
    
	// public String getFirmware() {
	// 	return firmware;
	// }
	// public void setFirmware(String firmware) {
	// 	this.firmware = firmware;
	// }
	// public String getDeviceName() {
	// 	return deviceName;
	// }
	// public void setDeviceName(String deviceName) {
	// 	this.deviceName = deviceName;
	// }
	public String getDeviceType() {
		return deviceType;
	}
	public void setDeviceType(String deviceType) {
		this.deviceType = deviceType;
	}
	public String getVan() {
		return van;
	}
	public void setVan(String van) {
		this.van = van;
	}
	public String getVbn() {
		return vbn;
	}
	public void setVbn(String vbn) {
		this.vbn = vbn;
	}
	public String getVcn() {
		return vcn;
	}
	public void setVcn(String vcn) {
		this.vcn = vcn;
	}
	public String getVab() {
		return vab;
	}
	public void setVab(String vab) {
		this.vab = vab;
	}
	public String getVbc() {
		return vbc;
	}
	public void setVbc(String vbc) {
		this.vbc = vbc;
	}
	public String getVca() {
		return vca;
	}
	public void setVca(String vca) {
		this.vca = vca;
	}
	public String getIa() {
		return ia;
	}
	public void setIa(String ia) {
		this.ia = ia;
	}
	public String getIb() {
		return ib;
	}
	public void setIb(String ib) {
		this.ib = ib;
	}
	public String getIc() {
		return ic;
	}
	public void setIc(String ic) {
		this.ic = ic;
	}
	public String getFreq() {
		return freq;
	}
	public void setFreq(String freq) {
		this.freq = freq;
	}
	public String getPf() {
		return pf;
	}
	public void setPf(String pf) {
		this.pf = pf;
	}
	public String getWatt() {
		return watt;
	}
	public void setWatt(String watt) {
		this.watt = watt;
	}
	// public String getWattHr() {
	// 	return wattHr;
	// }
	// public void setWattHr(String wattHr) {
	// 	this.wattHr = wattHr;
	// }
	// @Override
	// public String toString() {
	// 	return "NexusData [firmware=" + firmware + ", deviceName=" + deviceName + ", deviceType=" + deviceType
	// 			+ ", van=" + van + ", vbn=" + vbn + ", vcn=" + vcn + ", vab=" + vab + ", vbc=" + vbc + ", vca=" + vca
	// 			+ ", ia=" + ia + ", ib=" + ib + ", ic=" + ic + ", freq=" + freq + ", pf=" + pf + ", watt=" + watt
	// 			+ ", wattHr=" + wattHr + "]";
	// }	
	@Override
	public String toString() {
		return "NexusData [deviceType=" + deviceType
				+ ", van=" + van + ", vbn=" + vbn + ", vcn=" + vcn + ", vab=" + vab + ", vbc=" + vbc + ", vca=" + vca
				+ ", ia=" + ia + ", ib=" + ib + ", ic=" + ic + ", freq=" + freq + ", pf=" + pf + ", watt=" + watt
				+ "]";
	}

    // Getters and Setters
    
}

package com.verizon.ucs.model;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;

@JsonIgnoreProperties(ignoreUnknown = true)
public class DeviceInfo {

	@JsonProperty("device_name")
	private String deviceName;

	@JsonProperty("device_ip")
	private String deviceIP;

	@JsonProperty("pollercluster")
	private String pollerCluster;

	@JsonProperty("model")
	private String model;

	@JsonProperty("frequency")
	private String frequency;

	public String getDeviceName() {
		return deviceName;
	}

	public void setDeviceName(String deviceName) {
		this.deviceName = deviceName;
	}

	public String getDeviceIP() {
		return deviceIP;
	}

	public void setDeviceIP(String deviceIP) {
		this.deviceIP = deviceIP;
	}

	public String getPollerCluster() {
		return pollerCluster;
	}

	public void setPollerCluster(String pollerCluster) {
		this.pollerCluster = pollerCluster;
	}

	public String getModel() {
		return model;
	}

	public void setModel(String model) {
		this.model = model;
	}

	public String getFrequency() {
		return frequency;
	}

	public void setFrequency(String frequency) {
		this.frequency = frequency;
	}

	@Override
	public String toString() {
		return "DeviceData [deviceName=" + deviceName + ", deviceIP=" + deviceIP + ", pollerCluster=" + pollerCluster
				+ ", model=" + model + ", frequency=" + frequency + "]";
	}

}


package com.verizon.ucs.controller;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.verizon.ucs.model.DeviceInfo;
import com.verizon.ucs.model.NexusData1250;
import com.verizon.ucs.model.NexusData1450;
import com.verizon.ucs.model.NexusData1500;
import com.verizon.ucs.parser.Nexus1250Parser;
import com.verizon.ucs.parser.Nexus1450Parser;
import com.verizon.ucs.parser.Nexus1500Parser;
import com.verizon.ucs.service.NexusService;

@RestController
@RequestMapping("/api/nexus")
public class PSCController {

	private static final Logger logger = LoggerFactory.getLogger(PSCController.class);
	
    @Autowired
    private NexusService service;

    @GetMapping("/data/{deviceIP}/{deviceType}")
    public ResponseEntity<Object> getNexusData(@PathVariable String deviceIP, @PathVariable String deviceType) {
        try {
            DeviceInfo info = new DeviceInfo();
            info.setDeviceIP(deviceIP);
            info.setModel(deviceType);

            Object data = service.processDevice(info);
            return ResponseEntity.ok(data);
        } catch (Exception e) {
            logger.error("Exception at api /data/deviceType {}", e);
            return ResponseEntity.status(500).body("Internal Server Error");
        }
    }
}

package com.verizon.ucs.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.retry.RetryCallback;
import org.springframework.retry.RetryContext;
import org.springframework.retry.RetryListener;
import org.springframework.retry.backoff.FixedBackOffPolicy;
import org.springframework.retry.policy.SimpleRetryPolicy;
import org.springframework.retry.support.RetryTemplate;

@Configuration
public class RetryConfig {
	@Autowired
	private RetryProperties retryProperties;

	@Bean
	public RetryTemplate retryTemplate() {
		RetryTemplate retryTemplate = new RetryTemplate();
		// Configure retry policy
		SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy();
		retryPolicy.setMaxAttempts(retryProperties.getMaxAttempts());
		retryTemplate.setRetryPolicy(retryPolicy);
		// Configure backoff policy
		FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
		backOffPolicy.setBackOffPeriod(retryProperties.getBackOffPeriod());
		retryTemplate.setBackOffPolicy(backOffPolicy);
		// Add retry listener for logging
		retryTemplate.registerListener(new RetryListener() {
			@Override
			public <T, E extends Throwable> boolean open(RetryContext context, RetryCallback<T, E> callback) {
				return true;
			}

			@Override
			public <T, E extends Throwable> void close(RetryContext context, RetryCallback<T, E> callback,
					Throwable throwable) {
			}

			@Override
			public <T, E extends Throwable> void onError(RetryContext context, RetryCallback<T, E> callback,
					Throwable throwable) {
				System.out.println(
						"Retry attempt " + context.getRetryCount() + " failed due to: " + throwable.getMessage());
			}
		});
		return retryTemplate;
	}
}

As a UCS developer, I want to normalize the power data retrieved from the Nexus 15xx model and publish it to the VMB so that 1PSC can consume the data in a consistent format.
RK-1: VMB instability may affect data publishing.
AS-1: VMB topic is configured and available.
*Technical Specifications*:

{"apiEndPoints":"\"UCS internal API endpoint for VMB publishing.\"","requestPayloadStructure":"\"Normalized power data (kW, kWh, etc.), timestamp.\"","responsePayloadStructure":"\"Success/failure status. HTTP status codes (200, 500).\"","authentication":"\"Secure communication between UCS and VMB.\"","errorHandling":"\"Error codes for publishing failures. Retry mechanism.\"","versioningInformation":"\"v1.0\"","performanceRequirementCriteria":"\"Publishing within 15 seconds\"","backwardCompatibility":"\"Yes\"","businessRules":"\"Data normalization rules.\"","loggingAndMonitoring":"\"Logs for successful/failed publishing attempts.\"","securityConsiderations":"\"Secure communication channel.\"","complianceRegulations":"\"N/A\"","documentationImpact":"\"Update documentation on VMB topic and data format.\""}

AC-2: Given a Nexus 1450 device is unreachable, when UCS requests data, send an lov notification to vmb
