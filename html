package com.verizon.cucumber;

import com.verizon.ucs.restapi.controllers.UCSPController;
import com.verizon.ucs.restapi.dto.ApiRequest;
import com.verizon.ucs.restapi.model.Device;
import com.verizon.ucs.restapi.model.UcspProject;
import com.verizon.ucs.restapi.service.UCSPService;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.List;
import java.util.Map;

import static org.junit.jupiter.api.Assertions.*;

public class UCSPControllerCucumberStepDef {

    @Autowired
    private UCSPService ucspService;

    @Autowired
    private UCSPController ucspController;

    private ApiRequest apiRequest;
    private List<Device> devices;
    private List<String> stringList;

    private List<String> ugcSources;
    private List<Map<String, Object>> ugcProjects;

    @Given("I have a device name {string}")
    public void iHaveADeviceName(String deviceName) {
        apiRequest = new ApiRequest();
        apiRequest.setDeviceName(deviceName);
    }

    @When("I search for devices by device name")
    public void iSearchForDevicesByDeviceName() {
        devices = ucspService.searchDevices(apiRequest);
    }

    @Then("I should get a list of devices with the name {string}")
    public void iShouldGetAListOfDevicesWithTheName(String deviceName) {
        assertTrue(devices.stream().allMatch(device -> device.getDeviceName().equalsIgnoreCase(deviceName)));
    }

    @When("I request all devices")
    public void iRequestAllDevices() {
        devices = ucspService.getAllDevices();
    }

    @When("I request unique models")
    public void iRequestUniqueModels() {
        stringList = ucspService.getUniqueValues().get("models");
    }

    @Then("I should get a list of unique device models")
    public void iShouldGetAListOfUniqueDeviceModels() {
        assertTrue(stringList.size() > 0);
    }

    @Given("I have a device vendor {string}")
    public void iHaveADeviceVendor(String vendor) {
        apiRequest = new ApiRequest();
    }

    @When("I search for devices by device vendor")
    public void iSearchForDevicesByDeviceVendor() {
        devices = ucspService.searchDevices(apiRequest);
    }

    @Given("I have a device network {string}")
    public void iHaveADeviceNetwork(String network) {
        apiRequest = new ApiRequest();
    }

    @When("I search for devices by device network")
    public void iSearchForDevicesByDeviceNetwork() {
        devices = ucspService.searchDevices(apiRequest);
    }


    @Given("I have a device model {string}")
    public void iHaveADeviceModel(String model) {
        apiRequest = new ApiRequest();
    }

    @When("I search for devices by device model")
    public void iSearchForDevicesByDeviceModel() {
        devices = ucspService.searchDevices(apiRequest);
    }

    @When("I request unique vendors")
    public void iRequestUniqueVendors() {
        stringList = ucspService.getUniqueValues().get("vendors");
    }

    @Then("I should get a list of unique device vendors")
    public void iShouldGetAListOfUniqueDeviceVendors() {
        assertTrue(stringList.size() > 0);
    }

    @When("I request unique networks")
    public void iRequestUniqueNetworks() {
        stringList = ucspService.getUniqueValues().get("networks");
    }

    @Then("I should get a list of unique device networks")
    public void iShouldGetAListOfUniqueDeviceNetworks() {
        assertTrue(stringList.size() > 0);
    }

    @When("I request unique ucg sources")
    public void iRequestUniqueUcgSources() {
        stringList = ucspService.getUniqueValues().get("ucgSources");
    }

    @Then("I should get a list of unique device ucg sources")
    public void iShouldGetAListOfUniqueDeviceUcgSources() {
        String result = "";
        assertNotNull(result);
        assertTrue(result.isEmpty());
    }
    @When("I request unique projects")
    public void i_request_unique_projects() {
        projectList=ucspController.getUniqueProjects();
    }

    @Then("I should receive a list of unique projects")
    public void i_should_receive_a_list_of_unique_projects() {
       assertTrue(projectList.size()>0);
    }

    @Given("a project with id {string}")
    public void aProjectWithId(String projectId) {
        // Not used in this scenario, but could be used to set up data
    }

    @When("I request the unique UCG sources for the project")
    public void iRequestTheUniqueUgcSourcesForTheProject() {
        ugcSources = ucspService.getUniqueUCGSourcesByProject(1L);
    }

    @Then("I should receive an empty list of UCG sources")
    public void iShouldReceiveAnEmptyListOfUgcSources() {
        assertEquals(1, ugcSources.size());
    }

    @When("I request the list of unique UCG projects")
    public void iRequestTheListOfUniqueUgcProjects() {
        ugcProjects = ucspService.getUniqueUCGProjects();
    }

    @Then("I should receive an empty list of UCG projects")
    public void iShouldReceiveAnEmptyListOfUgcProjects() {
        assertEquals(4, ugcProjects.size());
    }
}
