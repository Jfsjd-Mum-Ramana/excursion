package com.verizon.cucumber;

import com.verizon.ucs.restapi.controllers.UCSPController;
import com.verizon.ucs.restapi.dto.ApiRequest;
import com.verizon.ucs.restapi.dto.TrendsRequest;
import com.verizon.ucs.restapi.model.Device;
import com.verizon.ucs.restapi.model.Trends;
import com.verizon.ucs.restapi.model.UcspProject;
import com.verizon.ucs.restapi.service.UCSPService;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.List;
import java.util.Map;

import static org.junit.jupiter.api.Assertions.*;

public class UCSPControllerCucumberStepDef {

    @Autowired
    private UCSPService ucspService;

    @Autowired
    private UCSPController ucspController;

    private ApiRequest apiRequest;
    private TrendsRequest trendsRequest;
    private List<Device> devices;
    private List<String> stringList;
    private List<UcspProject> projectList;
    private List<String> ucgSources;
    private List<String> ucgProjects;

    @Given("I have a device name {string}")
    public void iHaveADeviceName(String deviceName) {
        apiRequest = new ApiRequest();
        apiRequest.setDeviceName(deviceName);
    }

    @When("I search for devices by device name")
    public void iSearchForDevicesByDeviceName() {
        devices = ucspController.getFilteredDevices(apiRequest);
    }

    @Then("I should get a list of devices with the name {string}")
    public void iShouldGetAListOfDevicesWithTheName(String deviceName) {
        assertTrue(devices.stream().allMatch(device -> device.getDeviceName().equalsIgnoreCase(deviceName)));
    }

    @When("I request all devices")
    public void iRequestAllDevices() {
        devices = ucspController.getAllDevices();
    }

    @When("I request unique models")
    public void iRequestUniqueModels() {
        stringList = ucspController.getUniqueModels();
    }

    @Then("I should get a list of unique device models")
    public void iShouldGetAListOfUniqueDeviceModels() {
        assertTrue(stringList.size() > 0);
    }

    @Given("I have a device vendor {string}")
    public void iHaveADeviceVendor(String vendor) {
        apiRequest = new ApiRequest();
        apiRequest.setVendor(vendor);
    }

    @When("I search for devices by device vendor")
    public void iSearchForDevicesByDeviceVendor() {
        devices = ucspController.getFilteredDevices(apiRequest);
    }

    @Given("I have a device network {string}")
    public void iHaveADeviceNetwork(String network) {
        apiRequest = new ApiRequest();
        apiRequest.setNetwork(network);
    }

    @When("I search for devices by device network")
    public void iSearchForDevicesByDeviceNetwork() {
        devices = ucspController.getFilteredDevices(apiRequest);
    }

    @When("I request unique vendors")
    public void iRequestUniqueVendors() {
        stringList = ucspController.getUniqueVendors();
    }

    @When("I request unique networks")
    public void iRequestUniqueNetworks() {
        stringList = ucspController.uniqueNetworks();
    }

    @When("I request unique UCG sources")
    public void iRequestUniqueUcgSources() {
        ucgSources = ucspController.getUniqueUCGSources();
    }

    @When("I request unique UCG sources by project id {long}")
    public void iRequestUniqueUcgSourcesByProjectId(long projectId) {
        ucgSources = ucspController.getUniqueUCGSourcesByProject(projectId);
    }

    @When("I request unique projects")
    public void iRequestUniqueProjects() {
        projectList = ucspController.getUniqueProjects();
    }

    @Then("I should get a list of unique vendors")
    public void iShouldGetAListOfUniqueVendors() {
        assertTrue(stringList.size() > 0);
    }

    @Then("I should get a list of unique networks")
    public void iShouldGetAListOfUniqueNetworks() {
        assertTrue(stringList.size() > 0);
    }

    @Then("I should get a list of unique UCG sources")
    public void iShouldGetAListOfUniqueUcgSources() {
        assertTrue(ucgSources.size() > 0);
    }

    @Then("I should get a list of unique UCG sources for project {long}")
    public void iShouldGetAListOfUniqueUcgSourcesForProject(long projectId) {
        assertTrue(ucgSources.size() > 0);
    }

    @Then("I should get a list of unique projects")
    public void iShouldGetAListOfUniqueProjects() {
        assertTrue(projectList.size() > 0);
    }

    @When("I request trends with UCG source ID {int}, from date {string}, and to date {string}")
    public void iRequestTrendsWithUcgSourceIdAndDateRange(int ucgSourceId, String fromDate, String toDate) {
        trendsRequest = new TrendsRequest();
        trendsRequest.setUcgSourceID(ucgSourceId);
        trendsRequest.setFromDate(Date.valueOf(fromDate));
        trendsRequest.setToDate(Date.valueOf(toDate));
        // Directly calling UCSPController for trends request
        List<Trends> trends = ucspController.getTrends(trendsRequest);
    }

    @Then("I should get a list of trends")
    public void iShouldGetAListOfTrends() {
        // This will need to be based on the response from the trends request
        assertNotNull(trends);
        assertFalse(trends.isEmpty());
    }
}
